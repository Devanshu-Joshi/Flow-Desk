<div class="flex flex-col max-h-[80vh] w-full">

    <!-- HEADER (fixed) -->
    <div class="px-5 sm:px-8 pt-8 pb-4 text-center shrink-0">
        <p class="text-xl sm:text-2xl font-semibold tracking-tight" [ngClass]="{
              'text-black': dialogTitleColor === 'text-primary',
              'text-yellow-500': dialogTitleColor === 'text-warn',
              'text-red-600': dialogTitleColor === 'text-danger'
            }">
            {{ dialogTitle }} Task
        </p>
        <p class="text-xs sm:text-sm text-gray-500 mt-1">
            {{ dialogDescription }}
        </p>
    </div>

    <!-- SCROLLABLE FORM CONTENT -->
    <div class="flex-1 overflow-y-auto px-5 sm:px-8 main-container">
        <form [formGroup]="form" (ngSubmit)="attemptSubmit()">

            <!-- TITLE -->
            <div class="border rounded-xl px-3 py-3 my-4 transition" [ngClass]="{
                    'border-red-500 ring-2 ring-red-500/20': isFieldInvalid('title'),
                    'border-gray-300 focus-within:border-indigo-500 focus-within:ring-2 focus-within:ring-indigo-500/20': !isFieldInvalid('title')
                }" [class.shake]="shakeField === 'title'">
                <div class="flex items-center gap-2 mb-2">
                    <i class="bx bx-edit text-gray-400"></i>
                    <span class="text-sm text-gray-600">Task Name</span>
                </div>
                <input type="text" formControlName="title" placeholder="Enter task name"
                    class="w-full border border-gray-300 rounded-lg px-3 py-2 bg-white outline-none text-sm
                    focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500/20 transition placeholder:text-gray-400" />
            </div>
            @if (isFieldInvalid('title')) {
            <p class="text-red-500 text-xs -mt-3 ml-3 mb-1">Task name is required (min 3 chars)</p>
            }

            <!-- DUE DATE -->
            <div class="border rounded-xl px-3 py-3 my-4 transition" [ngClass]="{
                    'border-red-500 ring-2 ring-red-500/20': isFieldInvalid('dueDate'),
                    'border-gray-300 focus-within:border-indigo-500 focus-within:ring-2 focus-within:ring-indigo-500/20': !isFieldInvalid('dueDate')
                }" [class.shake]="shakeField === 'dueDate'">
                <div class="flex items-center gap-2 mb-2">
                    <i class="bx bx-calendar text-gray-400"></i>
                    <span class="text-sm text-gray-600">Due Date</span>
                </div>
                <input type="date" formControlName="dueDate" placeholder="Select due date" class="w-full border border-gray-300 rounded-lg px-3 py-2 bg-white outline-none text-sm
                    focus:border-indigo-500 focus:ring-2 focus:ring-indigo-500/20 transition" />
            </div>
            @if (isFieldInvalid('dueDate')) {
            <p class="text-red-500 text-xs -mt-3 ml-3 mb-1">Due date is required</p>
            }

            <!-- ASSIGNED TO -->
            <div class="border rounded-xl px-3 py-3 my-4 transition sub-container" [ngClass]="{
                    'border-red-500 ring-2 ring-red-500/20': isFieldInvalid('assignedTo'),
                    'border-gray-300 focus-within:border-indigo-500 focus-within:ring-2 focus-within:ring-indigo-500/20': !isFieldInvalid('assignedTo')
                }" [class.shake]="shakeField === 'assignedTo'">
                <div class="flex items-center gap-2 mb-2">
                    <i class="bx bx-user-plus text-gray-400"></i>
                    <span class="text-sm text-gray-600">Assign Users</span>
                </div>
                <ng-select formControlName="assignedTo" [items]="users()" bindLabel="name" bindValue="id"
                    [multiple]="true" [closeOnSelect]="false" placeholder="Select users to assign"
                    class="filter-select assignedTo-select" [dropdownPosition]="'bottom'">
                </ng-select>
            </div>
            @if (isFieldInvalid('assignedTo')) {
            <p class="text-red-500 text-xs -mt-3 ml-3 mb-1">Please assign at least one user</p>
            }

            <!-- STATUS -->
            <div class="border rounded-xl px-3 py-3 my-4 transition" [ngClass]="{
                    'border-red-500 ring-2 ring-red-500/20': isFieldInvalid('status'),
                    'border-gray-300 focus-within:border-indigo-500 focus-within:ring-2 focus-within:ring-indigo-500/20': !isFieldInvalid('status')
                }" [class.shake]="shakeField === 'status'">
                <div class="flex items-center gap-2 mb-2">
                    <i class="bx bx-flag text-gray-400"></i>
                    <span class="text-sm text-gray-600">Status</span>
                </div>
                <ng-select formControlName="status" [items]="statusOptions" bindLabel="label" bindValue="value"
                    [searchable]="false" placeholder="Select task status" class="filter-select"
                    [dropdownPosition]="'bottom'">
                </ng-select>
            </div>
            @if (isFieldInvalid('status')) {
            <p class="text-red-500 text-xs -mt-3 ml-3 mb-1">Status is required</p>
            }

            <!-- PRIORITY -->
            <div class="relative border rounded-xl px-3 py-3 my-4 transition priorityContainer" [ngClass]="{
                    'border-red-500 ring-2 ring-red-500/20': isFieldInvalid('priority'),
                    'border-gray-300 focus-within:border-indigo-500 focus-within:ring-2 focus-within:ring-indigo-500/20': !isFieldInvalid('priority')
                }" [class.shake]="shakeField === 'priority'">
                <div class="flex items-center gap-2 mb-2">
                    <i class="bx bx-siren text-gray-400"></i>
                    <span class="text-sm text-gray-600">Priority</span>
                </div>
                <ng-select formControlName="priority" [items]="priorityOptions" bindLabel="label" bindValue="value"
                    [searchable]="false" placeholder="Select task priority" class="filter-select"
                    [dropdownPosition]="'bottom'" appendTo=".priorityContainer">
                </ng-select>
            </div>
            @if (isFieldInvalid('priority')) {
            <p class="text-red-500 text-xs -mt-3 ml-3 mb-1">Priority is required</p>
            }

        </form>
    </div>

    <!-- ACTION BUTTONS (fixed bottom) -->
    <div class="px-5 sm:px-8 pb-6 pt-4 bg-white shrink-0">
        <div class="flex flex-col sm:flex-row gap-3">
            <button type="button" (click)="cancel.emit()"
                class="w-full py-3 rounded-xl font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 transition">
                Cancel
            </button>

            <button type="button" (click)="attemptSubmit()" [ngClass]="{
                  'submit-btn text-white': dialogTitleColor === 'text-primary',
                  'edit-btn text-white': dialogTitleColor === 'text-warn',
                  'delete-btn text-white': dialogTitleColor === 'text-danger'
                }" class="w-full py-3 rounded-xl font-medium">
                {{ dialogSubmitText }} Task
            </button>
        </div>
    </div>

</div>