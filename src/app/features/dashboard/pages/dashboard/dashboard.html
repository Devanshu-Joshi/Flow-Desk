<div class="min-h-screen bg-linear-to-br from-white via-slate-50 to-white p-4 md:p-6 lg:p-8">

    <!-- ══════════════════════════════════════════════════════════
         SKELETON LOADING STATE
         ══════════════════════════════════════════════════════════ -->
    @if (!dataLoaded()) {
    <div class="animate-fade-in">

        <!-- Skeleton Header -->
        <div class="mb-8">
            <div class="flex items-center gap-3 mb-1">
                <div class="w-10 h-10 rounded-xl skeleton-shimmer"></div>
                <div class="space-y-2">
                    <div class="h-7 w-52 rounded-lg skeleton-shimmer"></div>
                    <div class="h-3.5 w-72 rounded-md skeleton-shimmer"></div>
                </div>
            </div>
        </div>

        <!-- Skeleton Stat Cards -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4 mb-8">
            @for (i of [1,2,3,4]; track i) {
            <div class="rounded-2xl p-4 md:p-5 border border-gray-100 bg-white overflow-hidden relative">
                <div class="absolute -top-6 -right-6 w-20 h-20 rounded-full bg-gray-50"></div>
                <div class="flex items-center gap-2 mb-3">
                    <div class="w-8 h-8 rounded-lg skeleton-shimmer"></div>
                    <div class="h-3 w-16 rounded skeleton-shimmer"></div>
                </div>
                <div class="h-9 w-14 rounded-lg skeleton-shimmer mb-1"></div>
                <div class="h-3 w-20 rounded skeleton-shimmer mt-1.5"></div>
            </div>
            }
        </div>

        <!-- Skeleton Charts Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6">
            <!-- Doughnut Skeleton -->
            <div class="rounded-2xl p-5 md:p-6 border border-gray-100 bg-white">
                <div class="flex items-center justify-between mb-5">
                    <div class="space-y-2">
                        <div class="h-4 w-36 rounded skeleton-shimmer"></div>
                        <div class="h-3 w-28 rounded skeleton-shimmer"></div>
                    </div>
                    <div class="flex gap-1 rounded-xl bg-gray-50 p-1">
                        <div class="h-7 w-16 rounded-lg skeleton-shimmer"></div>
                        <div class="h-7 w-16 rounded-lg skeleton-shimmer"></div>
                    </div>
                </div>
                <div class="flex items-center justify-center py-4">
                    <div class="relative">
                        <div class="w-48 h-48 rounded-full skeleton-shimmer-ring"></div>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <div class="w-32 h-32 rounded-full bg-white"></div>
                        </div>
                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                            <div class="h-7 w-10 rounded skeleton-shimmer mb-1"></div>
                            <div class="h-3 w-14 rounded skeleton-shimmer"></div>
                        </div>
                    </div>
                </div>
                <div class="flex justify-center gap-6 mt-3">
                    <div class="flex items-center gap-1.5">
                        <div class="w-3 h-3 rounded-full skeleton-shimmer"></div>
                        <div class="h-3 w-16 rounded skeleton-shimmer"></div>
                    </div>
                    <div class="flex items-center gap-1.5">
                        <div class="w-3 h-3 rounded-full skeleton-shimmer"></div>
                        <div class="h-3 w-16 rounded skeleton-shimmer"></div>
                    </div>
                    <div class="flex items-center gap-1.5">
                        <div class="w-3 h-3 rounded-full skeleton-shimmer"></div>
                        <div class="h-3 w-16 rounded skeleton-shimmer"></div>
                    </div>
                </div>
            </div>

            <!-- Polar Skeleton -->
            <div class="rounded-2xl p-5 md:p-6 border border-gray-100 bg-white">
                <div class="flex items-center justify-between mb-4">
                    <div class="space-y-2">
                        <div class="h-4 w-36 rounded skeleton-shimmer"></div>
                        <div class="h-3 w-52 rounded skeleton-shimmer"></div>
                    </div>
                    <div class="flex gap-1 rounded-xl bg-gray-50 p-1">
                        <div class="h-7 w-14 rounded-lg skeleton-shimmer"></div>
                        <div class="h-7 w-8 rounded-lg skeleton-shimmer"></div>
                    </div>
                </div>
                <div class="flex items-center justify-center py-4">
                    <div class="relative">
                        <svg class="w-48 h-48" viewBox="0 0 200 200">
                            <!-- Pre-computed polar segments (72° each) -->
                            <path d="M100,100 L100,20 A80,80 0 0,1 176.1,56.9 Z" class="skeleton-shimmer-svg"
                                style="animation-delay: 0s" />
                            <path d="M100,100 L176.1,56.9 A80,80 0 0,1 149.4,168.9 Z" class="skeleton-shimmer-svg"
                                style="animation-delay: 0.15s" />
                            <path d="M100,100 L149.4,168.9 A80,80 0 0,1 50.6,168.9 Z" class="skeleton-shimmer-svg"
                                style="animation-delay: 0.3s" />
                            <path d="M100,100 L50.6,168.9 A80,80 0 0,1 23.9,56.9 Z" class="skeleton-shimmer-svg"
                                style="animation-delay: 0.45s" />
                            <path d="M100,100 L23.9,56.9 A80,80 0 0,1 100,20 Z" class="skeleton-shimmer-svg"
                                style="animation-delay: 0.6s" />
                        </svg>
                    </div>
                </div>
                <div class="flex justify-center flex-wrap gap-4 mt-3">
                    @for (j of [1,2,3,4,5]; track j) {
                    <div class="flex items-center gap-1.5">
                        <div class="w-3 h-3 rounded-full skeleton-shimmer"></div>
                        <div class="h-3 w-14 rounded skeleton-shimmer"></div>
                    </div>
                    }
                </div>
            </div>

            <!-- Matrix Bar Chart Skeleton -->
            <div class="rounded-2xl p-5 md:p-6 border border-gray-100 bg-white">
                <div class="space-y-2 mb-3">
                    <div class="h-4 w-44 rounded skeleton-shimmer"></div>
                    <div class="h-3 w-64 rounded skeleton-shimmer"></div>
                </div>
                <div class="flex gap-1.5 mb-4">
                    <div class="h-7 w-24 rounded-lg skeleton-shimmer"></div>
                    <div class="h-7 w-24 rounded-lg skeleton-shimmer"></div>
                    <div class="h-7 w-24 rounded-lg skeleton-shimmer"></div>
                </div>
                <div class="h-55 md:h-70 flex items-end justify-around gap-4 px-4 pt-4 pb-8">
                    @for (bar of [75,55,85,45,65,40,70,50,60]; track $index) {
                    <div class="flex-1 flex flex-col items-center gap-1">
                        <div class="w-full rounded-t-md skeleton-shimmer" [style.height.%]="bar"
                            [style.animation-delay]="$index * 0.08 + 's'"></div>
                    </div>
                    }
                </div>
            </div>

            <!-- Timeline Skeleton -->
            <div class="rounded-2xl p-5 md:p-6 border border-gray-100 bg-white">
                <div class="flex items-center justify-between mb-5">
                    <div class="space-y-2">
                        <div class="h-4 w-40 rounded skeleton-shimmer"></div>
                        <div class="h-3 w-56 rounded skeleton-shimmer"></div>
                    </div>
                    <div class="flex gap-1 rounded-xl bg-gray-50 p-1">
                        <div class="h-7 w-16 rounded-lg skeleton-shimmer"></div>
                        <div class="h-7 w-20 rounded-lg skeleton-shimmer"></div>
                    </div>
                </div>
                <div class="h-55 md:h-70 relative">
                    <!-- Fake grid lines -->
                    <div class="absolute inset-0 flex flex-col justify-between py-2">
                        @for (line of [1,2,3,4,5]; track line) {
                        <div class="border-t border-gray-100 w-full"></div>
                        }
                    </div>
                    <!-- Fake line chart path -->
                    <svg class="absolute inset-0 w-full h-full" preserveAspectRatio="none" viewBox="0 0 400 200">
                        <defs>
                            <linearGradient id="skelGrad" x1="0" y1="0" x2="0" y2="1">
                                <stop offset="0%" stop-color="#e0e7ff" stop-opacity="0.5" />
                                <stop offset="100%" stop-color="#e0e7ff" stop-opacity="0" />
                            </linearGradient>
                        </defs>
                        <path d="M0,180 Q50,160 100,140 T200,100 T300,70 T400,40 L400,200 L0,200 Z"
                            fill="url(#skelGrad)" class="skeleton-shimmer-svg" />
                        <path d="M0,180 Q50,160 100,140 T200,100 T300,70 T400,40" fill="none" stroke="#c7d2fe"
                            stroke-width="3" stroke-linecap="round" class="skeleton-shimmer-svg" />
                    </svg>
                    <!-- Fake dots -->
                    <div class="absolute inset-0 flex items-end justify-between px-2 pb-6">
                        @for (dot of [80,60,40,30,50,25,20]; track $index) {
                        <div class="w-3 h-3 rounded-full skeleton-shimmer" [style.margin-bottom.%]="dot"
                            [style.animation-delay]="$index * 0.1 + 's'"></div>
                        }
                    </div>
                </div>
            </div>
        </div>

        <!-- Skeleton Team Roster -->
        <div class="mt-8">
            <div class="rounded-2xl p-5 md:p-6 border border-gray-100 bg-white">
                <div class="flex items-center gap-3 mb-5">
                    <div class="w-9 h-9 rounded-xl skeleton-shimmer"></div>
                    <div class="space-y-2">
                        <div class="h-4 w-28 rounded skeleton-shimmer"></div>
                        <div class="h-3 w-48 rounded skeleton-shimmer"></div>
                    </div>
                </div>
                <!-- Table Header -->
                <div class="hidden md:grid grid-cols-12 gap-3 px-4 py-2.5 rounded-xl mb-2">
                    <div class="col-span-4 h-3 w-16 rounded skeleton-shimmer"></div>
                    <div class="col-span-2 h-3 w-16 rounded skeleton-shimmer mx-auto"></div>
                    <div class="col-span-2 h-3 w-16 rounded skeleton-shimmer mx-auto"></div>
                    <div class="col-span-2 h-3 w-16 rounded skeleton-shimmer mx-auto"></div>
                    <div class="col-span-2 h-3 w-16 rounded skeleton-shimmer mx-auto"></div>
                </div>
                <!-- Skeleton Rows -->
                <div class="space-y-1.5">
                    @for (row of [1,2,3,4,5]; track row) {
                    <div class="grid grid-cols-1 md:grid-cols-12 gap-2 md:gap-3 items-center px-4 py-3 rounded-xl border border-gray-50"
                        [style.animation-delay]="row * 0.1 + 's'">
                        <div class="col-span-1 md:col-span-4 flex items-center gap-3">
                            <div class="w-9 h-9 rounded-xl skeleton-shimmer shrink-0"></div>
                            <div class="space-y-1.5 flex-1">
                                <div class="h-3.5 rounded skeleton-shimmer" [style.width]="(60 + row * 8) + '%'"></div>
                                <div class="h-3 w-14 rounded skeleton-shimmer"></div>
                            </div>
                        </div>
                        <div class="hidden md:flex col-span-2 justify-center">
                            <div class="h-6 w-9 rounded-lg skeleton-shimmer"></div>
                        </div>
                        <div class="hidden md:flex col-span-2 justify-center">
                            <div class="h-6 w-9 rounded-lg skeleton-shimmer"></div>
                        </div>
                        <div class="hidden md:flex col-span-2 justify-center">
                            <div class="h-6 w-9 rounded-lg skeleton-shimmer"></div>
                        </div>
                        <div class="hidden md:flex col-span-2 justify-center">
                            <div class="h-6 w-9 rounded-lg skeleton-shimmer"></div>
                        </div>
                    </div>
                    }
                </div>
            </div>
        </div>
    </div>
    }

    <!-- ══════════════════════════════════════════════════════════
         ACTUAL DASHBOARD CONTENT
         ══════════════════════════════════════════════════════════ -->
    @if (dataLoaded()) {
    <div class="animate-fade-in">

        <!-- ─── HEADER ─── -->
        <div class="mb-8">
            <div class="flex items-center gap-3 mb-1">
                <div
                    class="w-10 h-10 bg-linear-to-br from-indigo-400 to-cyan-400 rounded-xl flex items-center justify-center shadow-lg shadow-indigo-200/40">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                </div>
                <h1 class="text-2xl md:text-3xl font-bold tracking-tight">
                    <span
                        class="bg-linear-to-r from-indigo-400 via-purple-400 to-cyan-400 bg-clip-text text-transparent">Flowdesk</span>
                    <span class="text-gray-600 font-light ml-2">Analytics</span>
                </h1>
            </div>
            <p class="text-gray-700 text-sm ml-13">
                Real-time insights into your team's productivity
            </p>
        </div>

        <!-- ════════════ STAT CARDS ════════════ -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4 mb-8">
            <!-- Total Tasks -->
            <div class="relative overflow-hidden rounded-2xl p-4 md:p-5 border transition-all duration-300 group"
                [ngClass]="cCard">
                <div class="absolute -top-6 -right-6 w-20 h-20 rounded-full transition-colors"
                    [ngClass]="isDark ? 'bg-indigo-500/5 group-hover:bg-indigo-500/10' : 'bg-indigo-50 group-hover:bg-indigo-100/80'">
                </div>
                <div class="flex items-center gap-2 mb-2">
                    <div class="w-8 h-8 rounded-lg flex items-center justify-center"
                        [ngClass]="isDark ? 'bg-indigo-500/10' : 'bg-indigo-50'">
                        <i class="bx bx-task text-indigo-500 text-base"></i>
                    </div>
                    <span class="text-[11px] uppercase tracking-widest font-medium" [ngClass]="cSub">Total Tasks</span>
                </div>
                <div class="text-3xl font-bold" [ngClass]="cStatVal">{{ tasks().length }}</div>
            </div>

            <!-- Completed -->
            <div class="relative overflow-hidden rounded-2xl p-4 md:p-5 border transition-all duration-300 group"
                [ngClass]="cCard">
                <div class="absolute -top-6 -right-6 w-20 h-20 rounded-full transition-colors"
                    [ngClass]="isDark ? 'bg-emerald-500/5 group-hover:bg-emerald-500/10' : 'bg-emerald-50 group-hover:bg-emerald-100/80'">
                </div>
                <div class="flex items-center gap-2 mb-2">
                    <div class="w-8 h-8 rounded-lg flex items-center justify-center"
                        [ngClass]="isDark ? 'bg-emerald-500/10' : 'bg-emerald-50'">
                        <i class="bx bx-check-circle text-emerald-500 text-base"></i>
                    </div>
                    <span class="text-[11px] uppercase tracking-widest font-medium" [ngClass]="cSub">Completed</span>
                </div>
                <div class="text-3xl font-bold text-emerald-500">{{ completedCount }}</div>
                <div class="text-[11px] mt-1" [ngClass]="cStatSub">{{ completionPct }}% rate</div>
            </div>

            <!-- My Assigned -->
            <div class="relative overflow-hidden rounded-2xl p-4 md:p-5 border transition-all duration-300 group"
                [ngClass]="cCard">
                <div class="absolute -top-6 -right-6 w-20 h-20 rounded-full transition-colors"
                    [ngClass]="isDark ? 'bg-purple-500/5 group-hover:bg-purple-500/10' : 'bg-purple-50 group-hover:bg-purple-100/80'">
                </div>
                <div class="flex items-center gap-2 mb-2">
                    <div class="w-8 h-8 rounded-lg flex items-center justify-center"
                        [ngClass]="isDark ? 'bg-purple-500/10' : 'bg-purple-50'">
                        <i class="bx bx-user-check text-purple-500 text-base"></i>
                    </div>
                    <span class="text-[11px] uppercase tracking-widest font-medium" [ngClass]="cSub">My Assigned</span>
                </div>
                <div class="text-3xl font-bold text-purple-500">{{ myAssignedCount }}</div>
            </div>

            <!-- Team Size -->
            <div class="relative overflow-hidden rounded-2xl p-4 md:p-5 border transition-all duration-300 group"
                [ngClass]="cCard">
                <div class="absolute -top-6 -right-6 w-20 h-20 rounded-full transition-colors"
                    [ngClass]="isDark ? 'bg-cyan-500/5 group-hover:bg-cyan-500/10' : 'bg-cyan-50 group-hover:bg-cyan-100/80'">
                </div>
                <div class="flex items-center gap-2 mb-2">
                    <div class="w-8 h-8 rounded-lg flex items-center justify-center"
                        [ngClass]="isDark ? 'bg-cyan-500/10' : 'bg-cyan-50'">
                        <i class="bx bx-group text-cyan-500 text-base"></i>
                    </div>
                    <span class="text-[11px] uppercase tracking-widest font-medium" [ngClass]="cSub">Team Size</span>
                </div>
                <div class="text-3xl font-bold text-cyan-500">{{ teamSize }}</div>
                <div class="text-[11px] mt-1" [ngClass]="cStatSub">direct reports</div>
            </div>
        </div>

        <!-- ════════════ CHARTS GRID ════════════ -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6">

            <!-- ──── CHART 1: DOUGHNUT ──── -->
            <div class="rounded-2xl p-5 md:p-6 border transition-all duration-300" [ngClass]="cCard">
                <div class="flex items-center justify-between mb-5">
                    <div>
                        <h2 class="text-[15px] font-semibold" [ngClass]="cTitle">Task Health Overview</h2>
                        <p class="text-[11px] mt-0.5" [ngClass]="cSub">Distribution by {{ doughnutMode }}</p>
                    </div>
                    <div class="flex rounded-xl p-1 gap-0.5" [ngClass]="isDark ? 'bg-slate-700/40' : 'bg-gray-100'">
                        <button (click)="toggleDoughnut('status')"
                            class="px-3 py-1.5 rounded-lg text-[11px] font-semibold transition-all duration-200"
                            [ngClass]="doughnutMode === 'status'
              ? 'bg-indigo-500 text-white shadow-lg shadow-indigo-500/25'
              : (isDark ? 'text-gray-500 hover:text-gray-300' : 'text-gray-400 hover:text-gray-600')">Status</button>
                        <button (click)="toggleDoughnut('priority')"
                            class="px-3 py-1.5 rounded-lg text-[11px] font-semibold transition-all duration-200"
                            [ngClass]="doughnutMode === 'priority'
              ? 'bg-indigo-500 text-white shadow-lg shadow-indigo-500/25'
              : (isDark ? 'text-gray-500 hover:text-gray-300' : 'text-gray-400 hover:text-gray-600')">Priority</button>
                    </div>
                </div>
                <div class="relative max-w-65 mx-auto">
                    <canvas #doughnutCanvas></canvas>
                </div>
            </div>

            <!-- ──── CHART 2: POLAR AREA ──── -->
            <div class="rounded-2xl p-5 md:p-6 border transition-all duration-300" [ngClass]="cCard">
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <h2 class="text-[15px] font-semibold" [ngClass]="cTitle">Permission Spread</h2>
                        <p class="text-[11px] mt-0.5" [ngClass]="cSub">How permissions are distributed across users</p>
                    </div>
                    <div class="flex rounded-xl p-1 gap-0.5" [ngClass]="isDark ? 'bg-slate-700/40' : 'bg-gray-100'">
                        <button (click)="togglePolar('count')"
                            class="px-2.5 py-1.5 rounded-lg text-[11px] font-semibold transition-all duration-200"
                            [ngClass]="polarMode === 'count'
              ? 'bg-indigo-500 text-white shadow-lg shadow-indigo-500/25'
              : (isDark ? 'text-gray-500 hover:text-gray-300' : 'text-gray-400 hover:text-gray-600')">Count</button>
                        <button (click)="togglePolar('percentage')"
                            class="px-2.5 py-1.5 rounded-lg text-[11px] font-semibold transition-all duration-200"
                            [ngClass]="polarMode === 'percentage'
              ? 'bg-indigo-500 text-white shadow-lg shadow-indigo-500/25'
              : (isDark ? 'text-gray-500 hover:text-gray-300' : 'text-gray-400 hover:text-gray-600')">%</button>
                    </div>
                </div>
                <div class="max-w-65 mx-auto">
                    <canvas #polarCanvas></canvas>
                </div>
            </div>

            <!-- ──── CHART 3: PRIORITY × STATUS MATRIX ──── -->
            <div class="rounded-2xl p-5 md:p-6 border transition-all duration-300" [ngClass]="cCard">
                <div class="mb-3">
                    <h2 class="text-[15px] font-semibold" [ngClass]="cTitle">Priority × Status Matrix</h2>
                    <p class="text-[11px] mt-0.5" [ngClass]="cSub">Spot bottlenecks by cross-referencing priority &amp;
                        status</p>
                </div>
                <div class="flex flex-wrap gap-1.5 mb-4">
                    <button (click)="toggleMatrixFilter('COMPLETED')"
                        class="flex items-center gap-1.5 px-2.5 py-1 rounded-lg text-[11px] font-semibold border transition-all duration-200"
                        [ngClass]="matrixFilters['COMPLETED']
            ? 'bg-emerald-500/15 border-emerald-500/50 text-emerald-500'
            : (isDark ? 'bg-slate-700/20 border-slate-600/30 text-gray-600' : 'bg-gray-50 border-gray-200 text-gray-400')">
                        <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
                        Completed
                    </button>
                    <button (click)="toggleMatrixFilter('IN_PROGRESS')"
                        class="flex items-center gap-1.5 px-2.5 py-1 rounded-lg text-[11px] font-semibold border transition-all duration-200"
                        [ngClass]="matrixFilters['IN_PROGRESS']
            ? 'bg-amber-500/15 border-amber-500/50 text-amber-500'
            : (isDark ? 'bg-slate-700/20 border-slate-600/30 text-gray-600' : 'bg-gray-50 border-gray-200 text-gray-400')">
                        <span class="w-2 h-2 rounded-full bg-amber-500"></span>
                        In Progress
                    </button>
                    <button (click)="toggleMatrixFilter('INCOMPLETE')"
                        class="flex items-center gap-1.5 px-2.5 py-1 rounded-lg text-[11px] font-semibold border transition-all duration-200"
                        [ngClass]="matrixFilters['INCOMPLETE']
            ? 'bg-rose-500/15 border-rose-500/50 text-rose-500'
            : (isDark ? 'bg-slate-700/20 border-slate-600/30 text-gray-600' : 'bg-gray-50 border-gray-200 text-gray-400')">
                        <span class="w-2 h-2 rounded-full bg-rose-500"></span>
                        Incomplete
                    </button>
                </div>
                <div class="h-55 md:h-70">
                    <canvas #matrixCanvas></canvas>
                </div>
            </div>

            <!-- ──── CHART 4: TIMELINE (full width) ──── -->
            <div class="rounded-2xl p-5 md:p-6 border transition-all duration-300" [ngClass]="cCard">
                <div class="flex items-center justify-between mb-5">
                    <div>
                        <h2 class="text-[15px] font-semibold" [ngClass]="cTitle">Task Creation Timeline</h2>
                        <p class="text-[11px] mt-0.5" [ngClass]="cSub">Aggregated by week · scales with any volume</p>
                    </div>
                    <div class="flex rounded-xl p-1 gap-0.5" [ngClass]="isDark ? 'bg-slate-700/40' : 'bg-gray-100'">
                        <button (click)="toggleTimeline('stacked')"
                            class="px-3 py-1.5 rounded-lg text-[11px] font-semibold transition-all duration-200"
                            [ngClass]="timelineMode === 'stacked'
              ? 'bg-indigo-500 text-white shadow-lg shadow-indigo-500/25'
              : (isDark ? 'text-gray-500 hover:text-gray-300' : 'text-gray-400 hover:text-gray-600')">Stacked</button>
                        <button (click)="toggleTimeline('cumulative')"
                            class="px-3 py-1.5 rounded-lg text-[11px] font-semibold transition-all duration-200"
                            [ngClass]="timelineMode === 'cumulative'
              ? 'bg-indigo-500 text-white shadow-lg shadow-indigo-500/25'
              : (isDark ? 'text-gray-500 hover:text-gray-300' : 'text-gray-400 hover:text-gray-600')">Cumulative</button>
                    </div>
                </div>
                <div class="h-55 md:h-70">
                    <canvas #timelineCanvas></canvas>
                </div>
            </div>
        </div>

        <!-- ════════════ TEAM ROSTER SECTION ════════════ -->
        <div class="mt-8">
            <div class="rounded-2xl p-5 md:p-6 border transition-all duration-300" [ngClass]="cCard">
                <!-- Section Header -->
                <div class="flex items-center justify-between mb-5">
                    <div class="flex items-center gap-3">
                        <div class="w-9 h-9 rounded-xl flex items-center justify-center"
                            [ngClass]="isDark ? 'bg-indigo-500/10' : 'bg-indigo-50'">
                            <i class="bx bx-group text-indigo-500 text-lg"></i>
                        </div>
                        <div>
                            <h2 class="text-[15px] font-semibold" [ngClass]="cTitle">Team Roster</h2>
                            <p class="text-[11px] mt-0.5" [ngClass]="cSub">
                                {{ teamMembers.length }} members · sorted by assigned tasks
                            </p>
                        </div>
                    </div>
                    <!-- Pagination controls -->
                    <div *ngIf="showTeamPagination" class="flex items-center gap-2">
                        <span class="text-[11px]" [ngClass]="cSub">
                            {{ teamPage + 1 }} / {{ totalTeamPages }}
                        </span>
                        <button (click)="prevTeamPage()" [disabled]="teamPage === 0"
                            class="w-8 h-8 rounded-lg flex items-center justify-center border transition-all duration-200"
                            [ngClass]="teamPage === 0
              ? (isDark ? 'border-slate-700/30 text-slate-700 cursor-not-allowed' : 'border-gray-100 text-gray-300 cursor-not-allowed')
              : (isDark ? 'border-slate-600/40 text-gray-400 hover:text-white hover:border-indigo-500/50' : 'border-gray-200 text-gray-400 hover:text-gray-700 hover:border-indigo-300')">
                            <i class="bx bx-chevron-left text-lg"></i>
                        </button>
                        <button (click)="nextTeamPage()" [disabled]="teamPage >= totalTeamPages - 1"
                            class="w-8 h-8 rounded-lg flex items-center justify-center border transition-all duration-200"
                            [ngClass]="teamPage >= totalTeamPages - 1
              ? (isDark ? 'border-slate-700/30 text-slate-700 cursor-not-allowed' : 'border-gray-100 text-gray-300 cursor-not-allowed')
              : (isDark ? 'border-slate-600/40 text-gray-400 hover:text-white hover:border-indigo-500/50' : 'border-gray-200 text-gray-400 hover:text-gray-700 hover:border-indigo-300')">
                            <i class="bx bx-chevron-right text-lg"></i>
                        </button>
                    </div>
                </div>

                <!-- Table Header -->
                <div class="hidden md:grid grid-cols-12 gap-3 px-4 py-2.5 rounded-xl mb-2 text-[11px] uppercase tracking-wider font-semibold"
                    [ngClass]="isDark ? 'bg-slate-700/20 text-gray-500' : 'bg-gray-50 text-gray-400'">
                    <div class="col-span-4">Member</div>
                    <div class="col-span-2 text-center">Assigned</div>
                    <div class="col-span-2 text-center">Completed</div>
                    <div class="col-span-2 text-center">In Progress</div>
                    <div class="col-span-2 text-center">Incomplete</div>
                </div>

                <!-- Team Members Rows -->
                <div class="space-y-1.5">
                    <div *ngFor="let member of pagedTeamMembers; let i = index"
                        class="grid grid-cols-1 md:grid-cols-12 gap-2 md:gap-3 items-center px-4 py-3 rounded-xl border transition-all duration-200 group"
                        [ngClass]="isDark
            ? 'border-slate-700/20 hover:border-slate-600/40 hover:bg-slate-800/40'
            : 'border-gray-100 hover:border-gray-200 hover:bg-gray-50/80'">
                        <!-- Member Info -->
                        <div class="col-span-1 md:col-span-4 flex items-center gap-3">
                            <!-- Avatar -->
                            <div class="w-9 h-9 rounded-xl flex items-center justify-center text-xs font-bold text-white shrink-0 relative"
                                [style.background-color]="member.color">
                                {{ member.initials }}
                                <!-- Crown for admin -->
                                <span *ngIf="member.isAdmin"
                                    class="absolute -top-1.5 -right-1.5 text-amber-400 text-xs">
                                    <i class="bx bxs-crown"></i>
                                </span>
                            </div>
                            <div class="min-w-0">
                                <div class="flex items-center gap-1.5">
                                    <span class="text-sm font-semibold truncate" [ngClass]="cTitle">{{
                                        truncate(member.name,
                                        20) }}</span>
                                    <span *ngIf="member.isCurrent"
                                        class="text-[9px] px-1.5 py-0.5 rounded-full font-bold uppercase tracking-wider bg-indigo-500/15 text-indigo-500">You</span>
                                </div>
                                <span class="text-[11px]" [ngClass]="cSub">
                                    {{ member.isAdmin ? 'Admin' : 'Member' }}
                                </span>
                            </div>
                        </div>

                        <!-- Mobile Layout: Stat pills -->
                        <div class="col-span-1 md:hidden flex flex-wrap gap-2 ml-12">
                            <span
                                class="inline-flex items-center gap-1 text-[11px] px-2 py-0.5 rounded-lg font-semibold"
                                [ngClass]="isDark ? 'bg-indigo-500/10 text-indigo-400' : 'bg-indigo-50 text-indigo-600'">
                                <i class="bx bx-task text-xs"></i> {{ member.assigned }}
                            </span>
                            <span
                                class="inline-flex items-center gap-1 text-[11px] px-2 py-0.5 rounded-lg font-semibold"
                                [ngClass]="isDark ? 'bg-emerald-500/10 text-emerald-400' : 'bg-emerald-50 text-emerald-600'">
                                <i class="bx bx-check text-xs"></i> {{ member.completed }}
                            </span>
                            <span
                                class="inline-flex items-center gap-1 text-[11px] px-2 py-0.5 rounded-lg font-semibold"
                                [ngClass]="isDark ? 'bg-amber-500/10 text-amber-400' : 'bg-amber-50 text-amber-600'">
                                <i class="bx bx-clock-dashed-half"></i> {{ member.inProgress }}
                            </span>
                            <span
                                class="inline-flex items-center gap-1 text-[11px] px-2 py-0.5 rounded-lg font-semibold"
                                [ngClass]="isDark ? 'bg-rose-500/10 text-rose-400' : 'bg-rose-50 text-rose-600'">
                                <i class="bx bx-x text-xs"></i> {{ member.incomplete }}
                            </span>
                        </div>

                        <!-- Desktop: Assigned -->
                        <div class="hidden md:flex col-span-2 justify-center">
                            <span
                                class="inline-flex items-center justify-center min-w-7 px-2 py-0.5 rounded-lg text-sm font-bold"
                                [ngClass]="member.assigned > 0
                ? (isDark ? 'bg-indigo-500/10 text-indigo-400' : 'bg-indigo-50 text-indigo-600')
                : (isDark ? 'text-slate-600' : 'text-gray-300')">{{ member.assigned }}</span>
                        </div>

                        <!-- Desktop: Completed -->
                        <div class="hidden md:flex col-span-2 justify-center">
                            <span
                                class="inline-flex items-center justify-center min-w-7 px-2 py-0.5 rounded-lg text-sm font-bold"
                                [ngClass]="member.completed > 0
                ? (isDark ? 'bg-emerald-500/10 text-emerald-400' : 'bg-emerald-50 text-emerald-600')
                : (isDark ? 'text-slate-600' : 'text-gray-300')">{{ member.completed }}</span>
                        </div>

                        <!-- Desktop: In Progress -->
                        <div class="hidden md:flex col-span-2 justify-center">
                            <span
                                class="inline-flex items-center justify-center min-w-7 px-2 py-0.5 rounded-lg text-sm font-bold"
                                [ngClass]="member.inProgress > 0
                ? (isDark ? 'bg-amber-500/10 text-amber-400' : 'bg-amber-50 text-amber-600')
                : (isDark ? 'text-slate-600' : 'text-gray-300')">{{ member.inProgress }}</span>
                        </div>

                        <!-- Desktop: Incomplete -->
                        <div class="hidden md:flex col-span-2 justify-center">
                            <span
                                class="inline-flex items-center justify-center min-w-7 px-2 py-0.5 rounded-lg text-sm font-bold"
                                [ngClass]="member.incomplete > 0
                ? (isDark ? 'bg-rose-500/10 text-rose-400' : 'bg-rose-50 text-rose-600')
                : (isDark ? 'text-slate-600' : 'text-gray-300')">{{ member.incomplete }}</span>
                        </div>
                    </div>
                </div>


                <!-- Empty state -->
                <div *ngIf="teamMembers.length === 0" class="text-center py-12">
                    <i class="bx bx-group text-4xl" [ngClass]="isDark ? 'text-slate-700' : 'text-gray-300'"></i>
                    <p class="text-sm mt-2" [ngClass]="cSub">No team members found</p>
                </div>
            </div>
        </div>

    </div>
    }

</div>