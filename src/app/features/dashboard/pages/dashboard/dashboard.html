<div class="min-h-screen bg-linear-to-br from-cyan-100 to-blue-200 p-6">
    <div class="flex flex-col gap-7">

        <!-- Stats Card Component (UNTOUCHED) -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 w-full">
            <app-stats-card title="Total Tasks" [value]="49" subtitle="Tasks created so far" icon="bx-list-ul"
                theme="purple" />
            <app-stats-card title="Completed Tasks" [value]="49" subtitle="Great job!" icon="bx-check-circle"
                theme="green" />
            <app-stats-card title="In Progress Tasks" [value]="49" subtitle="Keep going!" icon="bx-loader-dots"
                theme="yellow" />
            <app-stats-card title="Incomplete Tasks" [value]="49" subtitle="Needs attention" icon="bx-x-circle"
                theme="red" />
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 max-w-7xl mx-auto">

            <!-- ═══════════════ LEFT CARD — Task Pie Chart ═══════════════ -->
            <div class="bg-white/70 backdrop-blur-lg rounded-3xl shadow-xl p-8 flex flex-col
                  transition hover:scale-[1.02] duration-300">

                <!-- Header: Title + Period Filter Pills -->
                <div class="flex flex-wrap justify-between items-center gap-3 mb-6">
                    <h2 class="text-2xl font-semibold text-gray-800">Task Overview</h2>

                    <div class="flex bg-gray-100/80 rounded-xl p-1 gap-0.5">
                        <button *ngFor="let period of periods" (click)="onPeriodChange(period.value)" [ngClass]="{
                      'bg-white text-gray-800 shadow-sm font-semibold': selectedPeriod === period.value,
                      'text-gray-500 hover:text-gray-700': selectedPeriod !== period.value
                    }" class="px-3.5 py-1.5 rounded-lg text-xs font-medium transition-all duration-200
                           whitespace-nowrap cursor-pointer">
                            {{ period.label }}
                        </button>
                    </div>
                </div>

                <!-- Chart + Legend (shown when data exists) -->
                <ng-container *ngIf="hasData; else noDataTemplate">
                    <div class="flex flex-col md:flex-row items-center gap-8 flex-1">

                        <!-- Doughnut Chart -->
                        <div class="w-52 h-52 md:w-60 md:h-60 relative flex-shrink-0">
                            <canvas id="taskPieChart"></canvas>
                            <div class="absolute inset-0 flex items-center justify-center text-center
                          pointer-events-none">
                                <div>
                                    <p class="text-[10px] text-gray-400 uppercase tracking-widest mb-1">Total</p>
                                    <p class="text-3xl font-extrabold text-gray-800 leading-none">
                                        {{ totalVisibleTasks }}
                                    </p>
                                    <p class="text-xs text-gray-400 mt-0.5">tasks</p>
                                </div>
                            </div>
                        </div>

                        <!-- Clickable Legend Items -->
                        <div class="space-y-2 w-full md:w-auto">
                            <div *ngFor="let legend of legends; let i = index" (click)="toggleLegend(i)" class="flex items-center gap-3 cursor-pointer select-none px-4 py-3
                          rounded-2xl transition-all duration-300" [ngClass]="{
                     'hover:bg-white/80 hover:shadow-sm': legend.active,
                     'opacity-35': !legend.active
                   }">

                                <!-- Color dot -->
                                <span class="w-3.5 h-3.5 rounded-full shrink-0 transition-all duration-300"
                                    [style.backgroundColor]="legend.active ? legend.color : '#CBD5E1'">
                                </span>

                                <!-- Label + count -->
                                <div class="flex-1 min-w-0">
                                    <p class="text-sm text-gray-500 transition-all duration-300"
                                        [ngClass]="{ 'line-through decoration-gray-300': !legend.active }">
                                        {{ legend.label }}
                                    </p>
                                    <div class="flex items-baseline gap-1.5">
                                        <span class="text-xl font-bold text-gray-800">{{ legend.count }}</span>
                                        <span class="text-xs text-gray-400 font-medium">{{ legend.percentage }}%</span>
                                    </div>
                                </div>

                                <!-- Toggle indicator -->
                                <span class="w-5 h-5 rounded-full flex items-center justify-center
                             text-[10px] transition-all duration-300" [ngClass]="{
                        'bg-emerald-50 text-emerald-500': legend.active,
                        'bg-gray-100 text-gray-400': !legend.active
                      }">
                                    <i class="bx" [ngClass]="legend.active ? 'bx-check' : 'bx-x'"></i>
                                </span>
                            </div>
                        </div>
                    </div>
                </ng-container>

                <!-- No Data Fallback -->
                <ng-template #noDataTemplate>
                    <div class="flex-1 flex flex-col items-center justify-center py-16">
                        <div class="w-16 h-16 rounded-2xl bg-gray-50 flex items-center justify-center mb-4">
                            <i class="bx bx-pie-chart-alt-2 text-3xl text-gray-300"></i>
                        </div>
                        <p class="text-gray-500 font-semibold text-base">No tasks found</p>
                        <p class="text-gray-400 text-sm mt-1 text-center max-w-[240px]">
                            There are no tasks scheduled for the selected time period
                        </p>
                    </div>
                </ng-template>
            </div>

            <!-- ═══════════════ RIGHT CARD — Bar Chart (UNTOUCHED) ═══════════════ -->
            <div class="bg-white/70 backdrop-blur-lg rounded-3xl shadow-xl p-8
                  transition hover:scale-[1.02] duration-300">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6">Salary Distribution</h2>
                <div class="h-96">
                    <canvas id="salaryChart"></canvas>
                </div>
            </div>

        </div>
    </div>
</div>