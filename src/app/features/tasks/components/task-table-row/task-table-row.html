<!-- Display ID -->
<td class="px-1 sm:px-1 py-2 sm:py-3 font-medium align-middle whitespace-nowrap">
    <div class="flex items-center h-full">
        <ng-container *ngTemplateOutlet="dragCellTemplate; context: {$implicit: task}">
        </ng-container>
        <div>
            {{ task.displayId }}
        </div>
    </div>
</td>

<!-- Title — use min-w + truncate so it never fully collapses -->
<td class="px-1.5 sm:px-4 py-2 sm:py-3 text-center font-medium text-gray-800">
    <span class="block truncate min-w-45 sm:min-w-60 mx-auto" [title]="task.title">
        {{ task.title | truncate:25:true }}
    </span>
</td>

<!-- Status -->
<td class="px-1.5 sm:px-4 py-2 sm:py-3 text-center whitespace-nowrap">
    <span
        class="inline-flex items-center px-2 py-1 sm:px-2.5 rounded-full text-[11px] sm:text-xs font-semibold whitespace-nowrap"
        [ngClass]="{
          'bg-green-50 text-green-600': task.status === 'COMPLETED',
          'bg-yellow-50 text-yellow-600': task.status === 'IN_PROGRESS',
          'bg-red-50 text-red-600': task.status === 'INCOMPLETE'
        }">
        {{ statusLabels[task.status] || task.status }}
    </span>
</td>

<!-- Due Date -->
<td class="px-1.5 sm:px-4 py-2 sm:py-3 text-gray-600 text-center whitespace-nowrap">
    {{ task.dueDate | date: 'dd/MM/yyyy' }}
</td>

<!-- Priority -->
<td class="px-1.5 sm:px-4 py-2 sm:py-3 text-center whitespace-nowrap">
    <span
        class="inline-flex items-center px-2 py-1 sm:px-2.5 rounded-full text-[11px] sm:text-xs font-semibold whitespace-nowrap"
        [ngClass]="{
          'bg-green-50 text-green-600': task.priority === 'LOW',
          'bg-yellow-50 text-yellow-600': task.priority === 'NORMAL',
          'bg-red-50 text-red-600': task.priority === 'HIGH'
        }">
        {{ task.priority }}
    </span>
</td>

<!-- ✅ Assigned Users — min-w so it never fully collapses -->
<td class="px-1.5 sm:px-4 py-2 sm:py-3 text-center">
    <!-- ^^^ md:block → md:table-cell -->
    <div class="assignees-container bordered min-w-45 sm:min-w-55" [class.has-more]="hiddenCountSig() > 0"
        [class.expanded]="expandedSig()" [attr.title]="getUsersTooltip(assignedUsersSig())"
        [class.few-users]="visibleUsersSig().length <= 2">

        @if(this.visibleUsersSig().length != 0){
        <div class="assignees-scroll flex justify-center">
            @for (user of visibleUsersSig(); track user.id) {
            <span class="assignee-chip">
                <img [src]="user.avatar" class="avatar" />
                <span class="name whitespace-nowrap">{{ user.name }}</span>
            </span>
            }

            @if (!expandedSig() && hiddenCountSig() > 0) {
            <span class="assignee-chip more-chip cursor-pointer whitespace-nowrap" (click)="toggleExpanded()">
                +{{ hiddenCountSig() }} more
            </span>
            }

        </div>
        } @else {
        <div class="w-full flex items-center justify-center gap-2 text-gray-400 text-sm font-medium whitespace-nowrap">
            <svg class="w-4 h-4 opacity-70 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="1.8">
                <circle cx="12" cy="8" r="4" />
                <path d="M4 20c2-4 14-4 16 0" />
            </svg>
            <span class="whitespace-nowrap">No users assigned</span>
        </div>
        }
    </div>
</td>

<!-- Actions -->
<td class="px-1.5 sm:px-4 py-2 sm:py-3 whitespace-nowrap">
    <div class="flex justify-center">
        <div class="flex items-center justify-center gap-2 w-full sm:w-auto">

            <button [disabled]="!canEditSig()" [class.opacity-40]="!canEditSig()"
                [class.cursor-not-allowed]="!canEditSig()"
                class="flex items-center justify-center gap-1 px-2.5 py-1 sm:py-1.5 rounded-md text-yellow-700 hover:bg-yellow-200 transition cursor-pointer whitespace-nowrap"
                (click)="canEditSig() && edit.emit(task)">
                <i class="bx bx-edit text-base"></i>
                <span class="whitespace-nowrap">Edit</span>
            </button>

            <button [disabled]="!canDeleteSig()" [class.opacity-40]="!canDeleteSig()"
                [class.cursor-not-allowed]="!canDeleteSig()"
                class="flex items-center justify-center gap-1 px-2.5 py-1 sm:py-1.5 rounded-md text-red-700 hover:bg-red-200 transition cursor-pointer whitespace-nowrap"
                (click)="canDeleteSig() && delete.emit(task)">
                <i class="bx bx-trash text-base"></i>
                <span class="whitespace-nowrap">Delete</span>
            </button>

        </div>
    </div>
</td>